#!/usr/bin/env php
<?php

use function Cekurte\Environment\env;
use LazerBall\HitTracker\{ElectronAppKernel, HostedAppKernel, StandaloneAppKernel};
use Symfony\Bundle\FrameworkBundle\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Input\InputOption;

set_time_limit(0);
ini_set('memory_limit', -1);
ini_set('display_errors', 'On');

require __DIR__.'/../vendor/autoload.php';

if (file_exists(__DIR__.'/../.env')) {
    $dotEnv = new \Dotenv\Dotenv(__DIR__.'/../');
    $dotEnv->load();
}

$input = new ArgvInput();
$env = $input->getParameterOption(['--env', '-e'], env('SYMFONY_ENV', 'development'));
$debug = env('SYMFONY_DEBUG', true)
    && !$input->hasParameterOption(['--no-debug', ''])
    && $env !== 'prod';

$defaultBuildType = env('HITTRACKER_BUILD_TYPE', 'standalone');
$buildType = $input->getParameterOption(['--build-type', '-b'], $defaultBuildType);

switch ($buildType) {
   case 'electron':
        $kernel = new ElectronAppKernel($env, $debug);
        break;
   case 'hosted':
        $kernel = new HostedAppKernel($env, $debug);
        break;
   case 'standalone':
        $kernel = new StandaloneAppKernel($env, $debug);
        break;
};

$application = new Application($kernel);
$application->getDefinition()->addOptions([
    new InputOption('--build-type', '-b', InputOption::VALUE_REQUIRED, 'Build Type.'),
]);
$application->run($input);
