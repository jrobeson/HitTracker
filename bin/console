#!/usr/bin/env php
<?php
use Symfony\Bundle\FrameworkBundle\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Input\InputOption;

set_time_limit(0);

require_once __DIR__.'/../var/bootstrap.php.cache';

if (file_exists(__DIR__.'/../.env')) {
    $dotEnv = new \Dotenv\Dotenv(__DIR__.'/../');
    $dotEnv->load();
}

$input = new ArgvInput();
$env = $input->getParameterOption(['--env', '-e'], $_SERVER['SYMFONY_ENV'] ?: 'dev');
$debug = (bool)$_SERVER['SYMFONY_DEBUG']
    && !$input->hasParameterOption(['--no-debug', ''])
    && $env !== 'prod';

$defaultBuildType = isset($_SERVER['SYMFONY__BUILD_TYPE'])
    ? $_SERVER['SYMFONY__BUILD_TYPE'] : 'hosted';
$buildType = $input->getParameterOption(['--build-type', '-b'], $defaultBuildType);

$kernelClass = ucfirst($buildType).'AppKernel';
$kernel = new $kernelClass($env, $debug);

$application = new Application($kernel);
$application->getDefinition()->addOptions([
    new InputOption('--build-type', '-b', InputOption::VALUE_REQUIRED, 'Build Type.'),
]);
$application->run($input);
