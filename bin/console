#!/usr/bin/env php
<?php

use function Cekurte\Environment\env;
use Symfony\Bundle\FrameworkBundle\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Input\InputOption;

set_time_limit(0);

require_once __DIR__.'/../app/autoload.php';

if (file_exists(__DIR__.'/../.env')) {
    $dotEnv = new \Dotenv\Dotenv(__DIR__.'/../');
    $dotEnv->load();
}

$input = new ArgvInput();
$env = $input->getParameterOption(['--env', '-e'], env('SYMFONY_ENV', 'dev'));
$debug = env($_SERVER['SYMFONY_DEBUG'], true)
    && !$input->hasParameterOption(['--no-debug', ''])
    && $env !== 'prod';

$defaultBuildType = env('SYMFONY__BUILD_TYPE', 'hosted');
$buildType = $input->getParameterOption(['--build-type', '-b'], $defaultBuildType);

$kernelClass = ucfirst($buildType).'AppKernel';
$kernel = new $kernelClass($env, $debug);

$application = new Application($kernel);
$application->getDefinition()->addOptions([
    new InputOption('--build-type', '-b', InputOption::VALUE_REQUIRED, 'Build Type.'),
]);
$application->run($input);
